name: MLOps Pipeline

on:
 push:
  branches:
   - main # Trigger workflow on push to the main branch
 pull_request:
  branches:
   - main # Trigger workflow on pull requests to the main branch
 workflow_dispatch: # Allow manual triggers

jobs:
 get-config: 
    uses: Azure/mlops-templates/.github/workflows/read-yaml.yml@mailn
    with:
       file_name: config-infra-prod.yml

 create-compute:
    needs: get-config
    uses: ./.github/workflows/custom-create-compute.yml
    with:
       cluster_name: cpu_cluster
       size: Standard_DS11_v2
       min_instance: 0
       max_instance: 1
       cluster_tier: dedicated
       resource_group: default_resource_group
       workspace_name: FitwellWorkspace

 secrets:
     creds: ${{secrets.AZURE_CREDENTIALS}}
     
 - name: Checkout Code
 uses: actions/checkout@v3

 - name: Set up Python
 uses: actions/setup-python@v4
 with:
 python-version: 3.9

 - name: Install Dependencies
 run: |
 python -m pip install --upgrade pip
 pip install -r requirements.txt

 train-model:
 runs-on: ubuntu-latest
 needs: test-model

 steps:
 - name: Checkout Code
 uses: actions/checkout@v3

 - name: Train Model
 run: |
 python train_model.py # Script to train the ML model
